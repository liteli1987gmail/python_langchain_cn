# é¢„æµ‹ä¿æŠ¤ï¼ˆPrediction Guardï¼‰

æœ¬é¡µé¢ä»‹ç»å¦‚ä½•åœ¨ LangChain ä¸­ä½¿ç”¨é¢„æµ‹ä¿æŠ¤ç”Ÿæ€ç³»ç»Ÿã€‚
å®ƒåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå®‰è£…å’Œè®¾ç½®ï¼Œä»¥åŠå¯¹ç‰¹å®šé¢„æµ‹ä¿æŠ¤å°è£…çš„å¼•ç”¨ã€‚

## å®‰è£…å’Œè®¾ç½®
- ä½¿ç”¨ `pip install predictionguard` å®‰è£… Python SDK
- è·å–ä¸€ä¸ªé¢„æµ‹ä¿æŠ¤è®¿é—®ä»¤ç‰Œï¼ˆå¦‚ [æ­¤å¤„](https://docs.predictionguard.com/) æ‰€è¿°ï¼‰ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼ˆ`PREDICTIONGUARD_TOKEN`ï¼‰

## LLM å°è£…å™¨

å­˜åœ¨ä¸€ä¸ªé¢„æµ‹ä¿æŠ¤ LLM å°è£…å™¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š
```python
from langchain.llms import PredictionGuard
```

åœ¨åˆå§‹åŒ– LLM æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•°æä¾›é¢„æµ‹ä¿æŠ¤æ¨¡å‹çš„åç§°ï¼š
```python
pgllm = PredictionGuard(model="MPT-7B-Instruct")
```

æ‚¨è¿˜å¯ä»¥ç›´æ¥é€šè¿‡å‚æ•°æä¾›è®¿é—®ä»¤ç‰Œï¼š
```python
pgllm = PredictionGuard(model="MPT-7B-Instruct", token="<your access token>")
```

æœ€åï¼Œæ‚¨å¯ä»¥æä¾›ä¸€ä¸ªâ€œoutputâ€å‚æ•°ï¼Œç”¨äºç»“æ„åŒ–/æ§åˆ¶ LLM çš„è¾“å‡ºï¼š
```python
pgllm = PredictionGuard(model="MPT-7B-Instruct", output={"type": "boolean"})
```

## ç¤ºä¾‹ç”¨æ³•

ä½¿ç”¨å—æ§æˆ–å—ä¿æŠ¤çš„ LLM å°è£…å™¨çš„åŸºæœ¬ç”¨æ³•ï¼š
```python
import os

import predictionguard as pg
from langchain.llms import PredictionGuard
from langchain import PromptTemplate, LLMChain

# Your Prediction Guard API key. Get one at predictionguard.com
os.environ["PREDICTIONGUARD_TOKEN"] = "<your Prediction Guard access token>"

# Define a prompt template
template = """Respond to the following query based on the context.

Context: EVERY comment, DM + email suggestion has led us to this EXCITING announcement! ğŸ‰ We have officially added TWO new candle subscription box options! ğŸ“¦
Exclusive Candle Box - $80 
Monthly Candle Box - $45 (NEW!)
Scent of The Month Box - $28 (NEW!)
Head to stories to get ALLL the deets on each box! ğŸ‘† BONUS: Save 50% on your first box with code 50OFF! ğŸ‰

Query: {query}

Result: """
prompt = PromptTemplate(template=template, input_variables=["query"])

# With "guarding" or controlling the output of the LLM. See the 
# Prediction Guard docs (https://docs.predictionguard.com) to learn how to 
# control the output with integer, float, boolean, JSON, and other types and
# structures.
pgllm = PredictionGuard(model="MPT-7B-Instruct", 
                        output={
                                "type": "categorical",
                                "categories": [
                                    "product announcement", 
                                    "apology", 
                                    "relational"
                                    ]
                                })
pgllm(prompt.format(query="What kind of post is this?"))
```

ä½¿ç”¨é¢„æµ‹ä¿æŠ¤å°è£…å™¨è¿›è¡ŒåŸºæœ¬çš„ LLM é“¾å¼è°ƒç”¨ï¼š
```python
import os

from langchain import PromptTemplate, LLMChain
from langchain.llms import PredictionGuard

# Optional, add your OpenAI API Key. This is optional, as Prediction Guard allows
# you to access all the latest open access models (see https://docs.predictionguard.com)
os.environ["OPENAI_API_KEY"] = "<your OpenAI api key>"

# Your Prediction Guard API key. Get one at predictionguard.com
os.environ["PREDICTIONGUARD_TOKEN"] = "<your Prediction Guard access token>"

pgllm = PredictionGuard(model="OpenAI-text-davinci-003")

template = """Question: {question}

Answer: Let's think step by step."""
prompt = PromptTemplate(template=template, input_variables=["question"])
llm_chain = LLMChain(prompt=prompt, llm=pgllm, verbose=True)

question = "What NFL team won the Super Bowl in the year Justin Beiber was born?"

llm_chain.predict(question=question)
```